{% extends 'base.html' %}


{% block content %}
    <ul>
        <li>
            {{ product.product__name }}<br>
            sku: {{ product.sku }}<br>
            {{ product.product_inventory__units }} pcs.
        </li>
    </ul> 
    

    <ul> 
        {% for attr in z %}
        <li>
            {{ attr.product_attribute__name }}
            <ul>
                {% for a in y %}
                    {% if attr.product_attribute__name == a.attribute_values__product_attribute__name %}
                        {% if a.attribute_values__attribute_value in product.field_a %}
                            <li id="target-{{ a.attribute_values__attribute_value }}"
                                class="selected fw-bold"
                                data-attribute="{{ attr.product_attribute__name }}"
                                value="{{ a.attribute_values__attribute_value }}"
                            >
                                {{ a.attribute_values__attribute_value }}
                            </li>
                        {% else %}
                            <li id="target-{{ a.attribute_values__attribute_value }}" 
                                class=""
                                data-attribute="{{ attr.product_attribute__name }}"
                                value="{{ a.attribute_values__attribute_value }}"
                            >
                                {{ a.attribute_values__attribute_value }}
                            </li>
                        {% endif %}
                    {% endif %}
                {% endfor %}
            </ul>
        </li>
        {% endfor %} 
    </ul>

<script>
    var d = {}
    let textBoxes = document.querySelectorAll('[id^=target]');

    let e = 0;
    let f = textBoxes.length;

    for (let i in textBoxes) {
        if (e < f) {
            if (textBoxes[i].classList.contains("selected")) {
                d[textBoxes[i].getAttribute('data-attribute')] = textBoxes[i].getAttribute("value");
            }
        } else {
            break;
        }
        e++;
        console.log(d);
    }

    textBoxes.forEach(el => el.addEventListener('click', function(e){
        let value = e.target.getAttribute("value")
        d[e.target.getAttribute("data-attribute")] = value;

        let querystring = buildUrlWithParams(d);
        let url = window.location.href.split('?')[0];
        window.location.href = url + '?' + querystring;
    }, false)
    );

    function buildUrlWithParams(data) {
        let searchparams = [];
        for (let d in data) {
            searchparams.push(d + '=' + data[d]);
        }
        return searchparams.join('&');
    }

</script>

{% endblock content %}
